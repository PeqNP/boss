<div class="ui-modal" style="width: 400px;">
  <script language="text/javascript">
    function $(this.id)(view) {
      async function resetPassword() {
        let code = view.ui.input("code").value;
        let password = view.ui.input("password").value;
        let retypePassword = view.ui.input("retype-password").value;

        if (password != retypePassword) {
          let msg = view.ui.div("error-message");
          msg.style.display = null;
          msg.innerHTML = "The passwords provided do not match.";
          return;
        }

        let request = {
          code: code,
          password: password
        }

        try {
          await os.network.json(`/account/reset-password`, request);
        }
        catch (error) {
          let msg = view.ui.div("error-message");
          msg.style.display = null;
          msg.innerHTML = error;
          return;
        }

        await os.ui.showInfo("Your password has been reset. Press OK to sign in.");
        let win = await $(app.controller).loadController("SignIn");
        win.ui.show();
        close();
      }
      this.resetPassword = resetPassword;

      function close() {
        view.ui.close();
      }
      this.close = close;

      function showSignIn() {
        os.ui.showSignIn();
        view.ui.close();
      }
      this.showSignIn = showSignIn;

      function viewDidLoad() {
        view.ui.input("code").focus();
      }
      this.viewDidLoad = viewDidLoad;

      this.didHitEnter = resetPassword;
    }
  </script>
  <div class="title">Sign In</div>
  <div class="container vbox gap-10">
    <div class="error-message" style="display: none;"></div>
    <div class="info-message">If your e-mail is in our system you will be sent a code to that e-mail. Please provide the code below with your new password.</div>

    <div class="text-field">
      <label for="code" class="text">Code</label>
      <input type="text" name="code">
    </div>

    <div class="text-field">
      <label for="password" class="text">New password</label>
      <input type="password" name="password">
    </div>
    <div class="text-field">
      <label for="retype-password" class="text">Re-type password</label>
      <input type="password" name="retype-password">
    </div>

    <div class="controls">
      <button class="primary" onclick="$(this.controller).close();">Close</button>
      <button class="default" onclick="$(this.controller).resetPassword();">Reset password</button>
    </div>

    <div class="footer">
      <a href="#" onclick="$(this.controller).showSignIn();">Sign In</a>
    </div>
  </div>
</div>

