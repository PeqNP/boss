<div class="ui-modal" style="width: 300px;">
  <script type="text/javascript">
    // NOTE: Progress bar controls are managed by OS
    function $(this.id)(view) {
      let close_fn; // async fn
      let indeterminate = false;
      let progressBar;

      async function stop() {
        view.ui.button("stop").disabled = true;
        if (isEmpty(close_fn)) {
          return;
        }

        message.innerHTML = "Stopping"
        await close_fn().then((result) => {
          view.ui.close();
        });
      }
      this.close = close;

      /**
       * Set the progress of the bar.
       *
       * `amount` is ignored if progress bar is "Indeterminate"
       *
       * @param {integer} amount - A value from 0-100, where the number represents the percent complete = `75` = 75% complete.
       * @param {string?} title - Title displayed directly above the progress bar.
       */
      function setProgress(amount, title) {
        if (!isEmpty(title)) {
          title.innerHTML = title;
        }
        if (!isEmpty(progressBar)) {
          progressBar.ui.setProgress(amount);
        }
      }
      this.setProgress = setProgress;

      function configure(_title, fn, _indeterminate) {
        title = _title;
        close_fn = fn;
        indeterminate = _indeterminate;
      }
      this.configure = configure;

      function viewDidLoad() {
        view.ui.div("title").innerHTML = title;
        let progressBar = view.ui.div("ui-progress-bar");
        if (indeterminate) {
          if (!progressBar.classList.contains("indeterminate")) {
              progressBar.classList.add("indeterminate");
          }
        }
        else {
          progressBar.ui.setProgress(0);
        }
      }
      this.viewDidLoad = viewDidLoad;
    }
  </script>
  <div class="container">
    <div class="ui-progress-bar">
      <div class="title"></div>
      <div class="ui-progress-controls">
        <div class="ui-progress-container"><div class="ui-progress"></div></div>
        <button name="stop" class="primary stop" onclick="$(this.controller).stop();">Stop</button>
      </div>
    </div>
  </div>
</div>
