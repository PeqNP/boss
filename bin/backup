#!/bin/zsh
#
# Backs up all databases from production
#

SERVER=$1
if [ ! -f "$SERVER" ]; then
    echo "Server file does not exist at ($SERVER)" >&2
    exit 1
fi

SERVER=$(cat "$SERVER")
if [[ "$SERVER" == "" ]]; then
    echo "Please add user@server config in ~/.boss/server" >&2
    exit 1
fi

echo "Backing up databases on server ($SERVER) to (~/tmp/boss)"

mkdir -p ~/tmp/boss/upload

scp -i ~/.boss/boss-key.pem -r "ubuntu@$SERVER:~/db/*" ~/tmp/boss/
scp -i ~/.boss/boss-key.pem -r "ubuntu@$SERVER:~/boss/public/upload/*" ~/tmp/boss/upload
